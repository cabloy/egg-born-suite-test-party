"use strict";function asyncGeneratorStep(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function _asyncToGenerator(s){return function(){var e=this,i=arguments;return new Promise(function(t,n){var r=s.apply(e,i);function o(e){asyncGeneratorStep(r,t,n,o,a,"next",e)}function a(e){asyncGeneratorStep(r,t,n,o,a,"throw",e)}o(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd&&define(e)}(function(){var e,t,n,r,o;function a(e){_classCallCheck(this,a),this.host=e,this.timerId=0}return _createClass(a,[{key:"render",value:(o=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.host.$util,t=t.text("Article Comment Count"),e.abrupt("return",'\n        <div class="article-comment-count">\n          <span class="title">'.concat(t,'</span>\n          <span class="count"></span>\n          <span class="date"></span> \n        </div>'));case 3:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"mount",value:(r=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.host.$content,e.next=3,this._loadCSS();case 3:n=t.interval,this.timerId=window.setInterval(_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r._fetchAndShow();case 2:case"end":return e.stop()}},e)})),n);case 5:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"unmount",value:(n=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.timerId&&(window.clearInterval(this.timerId),this.timerId=0);case 1:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"_fetchAndShow",value:(t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.host,t=r.$container,n=r.$$,e.next=3,this._getCount();case 3:r=e.sent,n(".article-comment-count .count",t).text(r),r=this._getNow(),n(".article-comment-count .date",t).text(r);case 9:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"_loadCSS",value:function(){return new Promise(function(e){require(["css!api/static/test/party/blocks/blockArticleCommentCount/main"],function(){e()})})}},{key:"_getCount",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.host,t=n.$util,r=n.$host,n={atomId:r.atomId},r={comment:1,where:{}},e.next=5,t.performAction({method:"post",url:"/a/base/comment/count",body:{key:n,options:r}});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_getNow",value:function(){return("view-cms"===this.host.$host.mode?window.util.time:window.Vue.prototype.$meta.util).formatDateTime()}}]),a});