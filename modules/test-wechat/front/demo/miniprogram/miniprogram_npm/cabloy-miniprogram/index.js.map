{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cabloy\"] = factory();\n\telse\n\t\troot[\"cabloy\"] = factory();\n})(self, function() {\nreturn /******/ (() => { // webpackBootstrap\n/******/ \tvar __webpack_modules__ = ({\n\n/***/ 380:\n/***/ ((module) => {\n\nmodule.exports = function (cabloy) {\n  return {\n    request: function request(options) {\n      if (options.url.indexOf('/') === 0) {\n        options.url = \"\".concat(cabloy.config.api.baseURL, \"/api\").concat(options.url);\n      }\n\n      var jwt = cabloy.util.getJwtAuthorization();\n\n      if (cabloy.data.dingtalk) {\n        if (!options.headers) options.headers = {};\n        options.headers.Authorization = \"Bearer \".concat(jwt);\n      } else {\n        if (!options.header) options.header = {};\n        options.header.Authorization = \"Bearer \".concat(jwt);\n      }\n\n      return new Promise(function (resolve, reject) {\n        options.success = function (res) {\n          var _statusCode = res.statusCode || res.status;\n\n          if (_statusCode !== 200) {\n            var error = new Error();\n            error.code = _statusCode;\n            return reject(error);\n          }\n\n          if (res.data.code !== 0) {\n            var _error = new Error();\n\n            _error.code = res.data.code;\n            _error.message = res.data.message;\n            return reject(_error);\n          }\n\n          if (res.data['eb-jwt-oauth']) {\n            cabloy.data.oauth = res.data['eb-jwt-oauth'];\n          }\n\n          resolve(res.data.data);\n        };\n\n        options.fail = function (err) {\n          reject(err);\n        };\n\n        if (cabloy.data.dingtalk) {\n          dd.httpRequest(options);\n        } else {\n          wx.request(options);\n        }\n      });\n    },\n    get: function get(url, options) {\n      options = options || {};\n      options.url = url;\n      options.method = 'GET';\n      return this.request(options);\n    },\n    post: function post(url, data, options) {\n      options = options || {};\n      options.url = url;\n      options.method = 'POST';\n      options.data = data;\n      return this.request(options);\n    }\n  };\n};\n\n/***/ }),\n\n/***/ 642:\n/***/ ((module) => {\n\nvar configDefault = {\n  base: {\n    providerScene: 'default',\n    locale: 'en-us'\n  },\n  api: {\n    baseURL: ''\n  },\n  locales: {\n    'en-us': 'English',\n    'zh-cn': 'Chinese'\n  }\n};\n\nmodule.exports = function (cabloy, options) {\n  return cabloy.util.extend({}, configDefault, options);\n};\n\n/***/ }),\n\n/***/ 793:\n/***/ ((module) => {\n\nmodule.exports = function (cabloy, options) {\n  var _instance = null;\n  var _user = null;\n  var _oauth = null;\n  var _locale = null;\n\n  var _wxSystemInfo = typeof wx !== 'undefined' && wx.getSystemInfoSync();\n\n  var _ddSysmtemInfo = typeof dd !== 'undefined' && dd.getSystemInfoSync();\n\n  var _container;\n\n  if (typeof dd !== 'undefined') {\n    _container = 'dingtalk';\n  } else if (typeof wx !== 'undefined' && _wxSystemInfo.environment !== 'wxwork') {\n    _container = 'wechat';\n  } else if (typeof wx !== 'undefined' && _wxSystemInfo.environment === 'wxwork') {\n    _container = 'wxwork';\n  }\n\n  return {\n    get systemInfo() {\n      return _wxSystemInfo || _ddSysmtemInfo;\n    },\n\n    get container() {\n      return _container;\n    },\n\n    get dingtalk() {\n      return _container === 'dingtalk';\n    },\n\n    get wechat() {\n      return _container === 'wechat';\n    },\n\n    get wxwork() {\n      return _container === 'wxwork';\n    },\n\n    get oauth() {\n      return _oauth;\n    },\n\n    set oauth(value) {\n      _oauth = value;\n    },\n\n    get user() {\n      return _user;\n    },\n\n    set user(value) {\n      _user = value;\n    },\n\n    get loggedIn() {\n      var user = this.user;\n      return user && user.agent.anonymous === 0;\n    },\n\n    get instance() {\n      return _instance;\n    },\n\n    set instance(value) {\n      _instance = value;\n    },\n\n    get locale() {\n      if (!_locale) {\n        _locale = cabloy.util.preferredLocale(this.systemInfo.language);\n      }\n\n      if (!_locale) {\n        _locale = cabloy.config.base.locale;\n      }\n\n      if (!_locale) {\n        _locale = 'en-us';\n      }\n\n      return _locale;\n    }\n\n  };\n};\n\n/***/ }),\n\n/***/ 586:\n/***/ ((module, __unused_webpack_exports, __webpack_require__) => {\n\nvar Util = __webpack_require__(233);\n\nvar Api = __webpack_require__(380);\n\nvar Data = __webpack_require__(793);\n\nvar Config = __webpack_require__(642);\n\nmodule.exports = function (app, options) {\n  var _util;\n\n  var _api;\n\n  var _data;\n\n  var _config;\n\n  var cabloy = {\n    get app() {\n      return app;\n    },\n\n    get util() {\n      if (!_util) {\n        _util = Util(this);\n      }\n\n      return _util;\n    },\n\n    get api() {\n      if (!_api) {\n        _api = Api(this);\n      }\n\n      return _api;\n    },\n\n    get data() {\n      if (!_data) {\n        _data = Data(this);\n      }\n\n      return _data;\n    },\n\n    get config() {\n      if (!_config) {\n        _config = Config(this, options);\n      }\n\n      return _config;\n    },\n\n    set config(value) {\n      if (!_config) {\n        _config = Config(this, options);\n      }\n\n      _config = this.util.extend({}, _config, value);\n    }\n\n  };\n  return cabloy;\n};\n\n/***/ }),\n\n/***/ 233:\n/***/ ((module) => {\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nmodule.exports = function (cabloy) {\n  return {\n    preferredLocale: function preferredLocale(locale) {\n      locale = locale.toLowerCase().replace(/_/g, '-');\n      var locales = cabloy.config.locales;\n      if (locales[locale]) return locale;\n      var localeShort = locale.split('-')[0];\n      return Object.keys(locales).find(function (item) {\n        return item.indexOf(localeShort) === 0;\n      });\n    },\n    login: function login(options) {\n      if (cabloy.data.dingtalk) {\n        return this.__login_dingtalk(options);\n      } else if (cabloy.data.wechat) {\n        return this.__login_wechat(options);\n      } else if (cabloy.data.wxwork) {\n        return this.__login_wxwork(options);\n      }\n    },\n    __login_wechat: function __login_wechat(options) {\n      var _this = this;\n\n      return new Promise(function (resolve, reject) {\n        var providerScene = cabloy.config.base.providerScene;\n\n        if (options && options.detail) {\n          _this.__login({\n            providerScene: providerScene,\n            code: null,\n            detail: options.detail\n          }).then(resolve)[\"catch\"](reject);\n        } else {\n          wx.login({\n            success: function success(res) {\n              var code = res.code;\n              wx.getSetting({\n                success: function success(res) {\n                  if (res.authSetting['scope.userInfo']) {\n                    wx.getUserInfo({\n                      success: function success(detail) {\n                        _this.__login({\n                          providerScene: providerScene,\n                          code: code,\n                          detail: detail\n                        }).then(resolve)[\"catch\"](reject);\n                      }\n                    });\n                  } else {\n                    _this.__login({\n                      providerScene: providerScene,\n                      code: code,\n                      detail: null\n                    }).then(resolve)[\"catch\"](reject);\n                  }\n                }\n              });\n            }\n          });\n        }\n      });\n    },\n    __login_wxwork: function __login_wxwork(options) {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        wx.qy.login({\n          success: function success(res) {\n            var providerScene = cabloy.config.base.providerScene;\n            var code = res.code;\n\n            _this2.__login({\n              providerScene: providerScene,\n              code: code\n            }).then(resolve)[\"catch\"](reject);\n          }\n        });\n      });\n    },\n    __login_dingtalk: function __login_dingtalk(options) {\n      var _this3 = this;\n\n      return new Promise(function (resolve, reject) {\n        dd.getAuthCode({\n          success: function success(res) {\n            var providerScene = cabloy.config.base.providerScene;\n            var code = res.authCode;\n\n            _this3.__login({\n              providerScene: providerScene,\n              code: code\n            }).then(resolve)[\"catch\"](reject);\n          }\n        });\n      });\n    },\n    __login: function __login(_ref) {\n      var providerScene = _ref.providerScene,\n          code = _ref.code,\n          detail = _ref.detail;\n      var url = \"/a/\".concat(cabloy.data.container, \"/authMini/login?locale=\").concat(cabloy.data.locale);\n      return cabloy.api.post(url, {\n        providerScene: providerScene,\n        code: code,\n        detail: detail\n      }).then(function (data) {\n        cabloy.data.user = data.user;\n        cabloy.data.instance = data.instance;\n        cabloy.config = data.config;\n        return data.user;\n      });\n    },\n    isObject: function isObject(o) {\n      return _typeof(o) === 'object' && o !== null && o.constructor && o.constructor === Object;\n    },\n    extend: function extend() {\n      var deep = true;\n      var to;\n      var from;\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      if (typeof args[0] === 'boolean') {\n        deep = args[0];\n        to = args[1];\n        args.splice(0, 2);\n        from = args;\n      } else {\n        to = args[0];\n        args.splice(0, 1);\n        from = args;\n      }\n\n      for (var i = 0; i < from.length; i += 1) {\n        var nextSource = args[i];\n\n        if (nextSource !== undefined && nextSource !== null) {\n          var keysArray = Object.keys(Object(nextSource));\n\n          for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex += 1) {\n            var nextKey = keysArray[nextIndex];\n            var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey);\n\n            if (desc !== undefined && desc.enumerable) {\n              if (!deep) {\n                to[nextKey] = nextSource[nextKey];\n              } else if (this.isObject(to[nextKey]) && this.isObject(nextSource[nextKey])) {\n                this.extend(to[nextKey], nextSource[nextKey]);\n              } else if (!this.isObject(to[nextKey]) && this.isObject(nextSource[nextKey])) {\n                to[nextKey] = {};\n                this.extend(to[nextKey], nextSource[nextKey]);\n              } else {\n                to[nextKey] = nextSource[nextKey];\n              }\n            }\n          }\n        }\n      }\n\n      return to;\n    },\n    getJwtAuthorization: function getJwtAuthorization() {\n      var oauth = cabloy.data.oauth;\n      if (!oauth) return '';\n      return oauth.expireTime - Date.now() > 120 * 1000 ? oauth.accessToken : oauth.refreshToken;\n    }\n  };\n};\n\n/***/ })\n\n/******/ \t});\n/************************************************************************/\n/******/ \t// The module cache\n/******/ \tvar __webpack_module_cache__ = {};\n/******/ \t\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/ \t\t// Check if module is in cache\n/******/ \t\tvar cachedModule = __webpack_module_cache__[moduleId];\n/******/ \t\tif (cachedModule !== undefined) {\n/******/ \t\t\treturn cachedModule.exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\t\t// no module.id needed\n/******/ \t\t\t// no module.loaded needed\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/ \t\n/******/ \t\t// Execute the module function\n/******/ \t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n/******/ \t\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/ \t\n/************************************************************************/\n/******/ \t\n/******/ \t// startup\n/******/ \t// Load entry module and return exports\n/******/ \t// This entry module is referenced by other modules so it can't be inlined\n/******/ \tvar __webpack_exports__ = __webpack_require__(586);\n/******/ \t\n/******/ \treturn __webpack_exports__;\n/******/ })()\n;\n});\n//# sourceMappingURL=index.js.map"]}